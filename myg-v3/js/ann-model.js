
// 激活函数1（Activation Function）
function LogisticSigmoid(x_matrix){
  return math.dotDivide(1,math.add(1,math.exp(math.unaryMinus(x_matrix))))
}
// console.log(LogisticSigmoid([1,2,3]));

// 激活函数2（Activation Function）
function Ramp(x_matrix){
  const a = math.matrix(x_matrix);
  const b = a.map(function (value, index, matrix) {
    return Math.max(0,value)
  });
  return b["_data"];
}

// SoftMax
function SoftMax(x_matrix){
  x = math.flatten(x_matrix);
  return math.divide(math.exp(x),math.multiply(math.ones(math.size(x)),math.exp(x)))
}
// console.log(SoftMax([1,2,3]));

// evaluate ann
function eval_ann(ann_input){
  // 从表单读取输入数据 ann_input
  // form_agrs = $('#form_agrs').serializeArray();
  // var ann_input = [];
  // for (k in form_agrs){
  //   ann_input.push([parseFloat(form_agrs[k].value)])
  // }
  for (var i=0,len=ann_input.length; i<len; i++){
    if (ann_input[i]==''){
      return null
    }
  }

  // 计算神经网络，输入数据标准化
  // var standard_input = math.dotDivide(math.subtract(ann_input,data_mean),data_std);
  // standard_input = LogisticSigmoid(standard_input);
  // standard_input.push([1]);

  // 输入不做标准化，也不使用 LogisticSigmoid 处理
  standard_input = ann_input;
  standard_input.push([1]);

  // 计算神经网络，隐藏层1
  ann_layer_1_out = math.multiply(ann_layer_1,standard_input);
  ann_layer_1_out.pop();
  ann_layer_1_out = Ramp(ann_layer_1_out);
  ann_layer_1_out.push([1]);

  // 计算神经网络，隐藏层2
  ann_layer_2_out = math.multiply(ann_layer_2,ann_layer_1_out);
  ann_layer_2_out.pop();
  ann_layer_2_out = math.atan(ann_layer_2_out);
  ann_layer_2_out.push([1]);

  // 计算神经网络，隐藏层3
  ann_layer_3_out = math.multiply(ann_layer_3,ann_layer_2_out);
  ann_layer_3_out.pop();
  ann_layer_3_out = Ramp(ann_layer_3_out);
  ann_layer_3_out.push([1]);

  // 计算神经网络，隐藏层3
  ann_layer_4_out = math.multiply(ann_layer_4,ann_layer_3_out);
  ann_layer_4_out.pop();

  // 计算神经网络，输出层
  sm = SoftMax(ann_layer_4_out);

  // 返回结果
  return sm[1]
}

// ===========================================================================
// const parser = math.parser()
// // 激活函数（Activation Function）
// parser.eval('LogisticSigmoid(x) = 1./(1.+e.^(-x))')
// console.log(parser.eval('LogisticSigmoid([1,2,3])'));
//
//
// // SoftMax
// parser.eval('SoftMax(x) = e.^(x)./(ones(size(x)[1])*(e.^(x)))')
// console.log(parser.eval('SoftMax([1,2,3])'));
// ===========================================================================


// 均值
// var data_mean = [
// [ 0.4222957014643363],
// [ 0.2960000000000000],
// [ 0.2012281530467643],
// [ 4.8936939064714220],
// [ 3.4907557864903160],
// [ 71.8597071327350000],
// [ 35.7004723665564500],
// [ 102.7477351916376000],
// [ 120.3545318725100000],
// [ 0.2654700047236656],
// [ 493.2668750000000000]
// ];

//标准差
// var data_std = [[0.168893],
// [0.495257],
// [10.4854],
// [348.174],
// [198.366],
// [5.82983],
// [274.449],
// [557.807]];

//输入→隐藏层1，Weight+Biases
var ann_layer_1 = [
[ 0.2576038539409637, 0.3730477690696716,-0.0446541234850884,-0.4051242172718048,-0.1717833578586578,-0.6005932688713074,-0.2203563451766968,-0.2830151021480560,-0.4441272616386414, 0.3422143459320068,-0.4833611845970154, 0.0000000000000000],
[ 1.3280352354049680, 3.6036858558654790, 4.9910392761230470,-0.4445390999317169, 1.2062461376190190, 0.3690946102142334,-0.5425739884376526,-0.0547524392604828,-0.5393634438514710, 4.2902331352233890, 0.1471506506204605,-1.3798328638076780],
[ 0.2439392507076263,-2.7827794551849370,-2.0142643451690670,-0.2460770457983017, 2.0360062122344970, 0.5768487453460693, 0.7650399208068848,-0.2115249335765839, 0.1091677248477936,-2.7535004615783690,-0.1239911317825317, 0.7778241038322449],
[ 0.5392433404922485, 0.5754575729370117, 0.0736264660954475, 0.0324748530983925,-0.4366419613361359,-0.5820862054824829, 0.0301939304918051,-0.0872570350766182,-0.2959202229976654,-0.5529911518096924,-0.4134013056755066, 0.0000000000000000],
[ 2.1214430332183840, 0.7947103381156921,-0.9121960401535030, 0.1952382773160934, 0.8386818766593930,-0.2409069687128067,-0.0093846181407571,-0.2145966142416000,-0.0959962531924248,-3.4339218139648440, 0.3047653436660767, 0.6914238333702087],
[-1.1407585144042970,-3.1298856735229490,-2.1201741695404050,-0.1814408451318741, 0.1322690546512604,-0.0948222801089287, 0.3840356171131134, 0.4568387269973755,-0.3636282384395599,-2.8908307552337650, 0.0757792517542839, 0.3020738363265991],
[-1.2252558469772340, 0.5945536494255066,-0.6284767985343933,-0.2082299441099167, 0.2695235610008240, 0.0482207648456097,-0.9093800783157350,-0.1495849490165710, 0.2989268004894257, 0.2546474635601044, 0.3376562893390656,-0.3467366695404053],
[ 1.6186996698379520, 3.8426210880279540, 3.3145837783813480, 0.6428636908531189, 1.0870060920715330, 0.1339296847581863,-0.3157485425472260, 0.3023940026760101,-0.1722404956817627, 1.8495824337005620, 0.4070223271846771,-0.2876035571098328],
[ 0.5928833484649658, 2.5780277252197270, 3.1128509044647220, 0.2359282076358795, 0.4460860788822174,-0.6823499202728271,-0.3700641393661499,-0.0565377585589886,-0.0875653997063637, 3.5951132774353030, 0.3824158608913422,-0.2875404357910156],
[-2.2782304286956790,-4.4803533554077150,-4.3009157180786130,-0.2674011886119843,-0.2665224969387054,-0.4462738037109375,-0.4099707305431366,-0.4374690651893616,-0.0455332323908806, 0.0786368250846863, 0.5522884130477905, 0.1225237771868706],
[-0.7940726280212402, 1.5401268005371090, 0.8191636204719540, 0.3065776526927948,-0.8741348385810850,-0.1097797378897667,-0.3243450224399567, 0.5198438763618469, 0.3239447772502899,-0.0589147098362446,-0.5166355967521667, 0.1096447035670280],
[-0.1011664643883705,-0.3955687582492828,-0.4791322648525238,-0.0299135725945234,-0.5410861968994141,-0.3936352431774139, 0.1551759243011475,-0.1184482797980309, 0.0299137700349093, 0.0361918471753597,-0.5219862461090088, 0.0000000000000000],
[ 0.4175682365894318, 3.6337997913360600, 3.6603045463562010, 0.5452948212623596, 0.7628706097602844,-0.0860063210129738,-0.1235042512416840, 0.0531281083822250, 0.4634103178977966, 4.9137887954711910,-0.0185454506427050,-0.6440769433975220],
[ 2.0602171421051030, 3.5578646659851070, 3.3135662078857420,-0.1581821143627167,-0.1959392875432968,-0.0443173795938492, 0.5033514499664307,-0.4334330558776855, 0.4711881577968597,-0.5350025892257690, 0.3194521367549896, 0.4005717933177948],
[ 1.3913121223449710,-0.8931517601013180, 3.1651995182037350, 0.2805398702621460, 1.0726196765899660, 0.4834550023078918,-0.7447129487991333, 0.4668124616146088,-0.2410674095153809, 1.5498863458633420,-0.4607967138290405,-0.1572984457015991],
[ 0.0946580022573471,-2.1343235969543460,-2.1174919605255130,-0.3459898233413696, 1.0060890913009640, 0.5859253406524658,-0.0865954682230949,-0.2367589026689529,-0.2104450762271881, 1.8765158653259280,-0.0792076736688614, 0.0969922691583633],
[-1.4060935974121090,-3.7455022335052490,-1.9259195327758790,-1.0814895629882810,-0.0680793523788452,-0.3117188513278961, 0.0457815937697887,-0.0273622963577509, 0.3085752725601196,-2.6120116710662840, 0.4730843305587769,-0.0414751209318638],
[-2.4608631134033200,-2.9985046386718750, 1.5341637134552000,-0.5801243782043457, 0.4233105778694153,-0.5679535865783691, 0.3595451116561890,-0.3182050883769989, 0.4821049571037292, 0.8719342947006230, 0.0290061831474304,-1.2180671691894530],
[-1.0695985555648800,-0.1172227486968040,-0.5836699604988098, 0.9690505862236020, 0.2003744095563889, 0.2736671268939972, 0.4834534227848053,-0.1574818193912506,-0.5637885928153992, 3.6130235195159910, 0.1780763119459152,-1.0000892877578740],
[-1.1512484550476070,-4.4171767234802250,-2.7423295974731450, 0.0648893341422081,-1.1757150888442990,-0.1089639514684677, 0.5734391212463379, 0.2595949769020081,-0.3612579405307770,-2.4502348899841310, 0.4012548327445984, 0.1793959587812424],
[-1.1156047582626340,-0.1285918354988098,-0.5868165493011475,-0.2728327512741089,-1.2841322422027590, 0.5245651006698608, 0.2185256034135818, 0.1276547163724899,-0.9654260873794560,-0.7744980454444885,-0.2584159374237060,-0.1221950054168701],
[ 0.8497843742370610, 2.3925206661224370, 2.6456298828125000, 0.2863218188285828,-0.3194244801998138,-0.1968868523836136, 0.0226977914571762, 0.1532898992300034,-0.5180921554565430, 4.3820343017578120, 0.2490517497062683,-0.3955076038837433],
[ 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 1.0000000000000000]
];

//输入→隐藏层2，Weight+Biases
var ann_layer_2 = [
[ 0.0243790112435818,-1.2393428087234500,-0.0755458772182465,-0.2417284846305847, 0.4501255452632904,-0.2763676643371582,-0.3827477097511292,-0.0585876628756523,-0.0950667932629585,-0.2146011739969254, 0.0063058487139642, 0.0613392926752567, 0.4827326238155365, 0.0773245394229889,-0.4985336065292358,-2.5425620079040530,-0.3175366222858429,-0.4125895202159882, 0.5048348307609558, 0.2520979344844818, 0.0550106391310692, 0.1070302203297615,-0.0681585967540741],
[-0.0454223528504372, 0.3282057940959930,-0.2894071936607361,-0.2606555819511414,-0.0839569792151451,-0.4108419120311737, 0.4210807085037231, 0.4259534180164337, 0.1952737271785736, 0.2590408623218536,-0.1758150458335876,-0.3037520945072174, 0.2122557163238525,-0.2604143023490906, 0.7321923375129700,-0.1602207124233246,-0.4174430668354034,-0.6412699222564697, 0.3993744850158691,-0.2020330429077148,-1.2692004442214970, 0.1501467823982239,-0.3200860619544983],
[ 0.1060346141457558, 0.9352796077728270, 0.2237953692674637,-0.4076032936573029,-0.2100627273321152, 0.3403102457523346,-0.0588619336485863, 0.0054184189066291, 0.9149198532104490, 0.2205228656530380, 1.2494586706161500, 0.2362301051616669, 0.4523553550243378,-0.1314461082220078, 0.6390534639358520,-0.1706814467906952, 0.2535273730754852, 1.1298307180404660,-0.2936695218086243,-0.5129321217536926, 0.7552804946899414,-0.1917798519134521,-0.9008797407150270],
[ 0.3253155648708344,-0.1146459206938744, 0.4614764153957367,-0.4268328249454498,-0.2286339551210403, 0.2777157425880432, 0.0151021154597402,-0.3198435604572296,-0.3109225034713745, 0.3796084523200989,-0.6403986811637878,-0.3712353110313416,-0.1662115007638931,-0.3618668019771576, 0.7555059790611267,-0.3159728348255157, 0.1636237949132919, 0.4524868726730347, 0.2489032447338104, 0.3148377537727356, 0.0529306009411812,-0.1331707388162613,-0.4823887348175049],
[ 0.0171709582209587,-0.1871060132980347,-0.2715992629528046, 0.1457482427358627, 0.5871189236640930, 0.2988068461418152,-0.1433398872613907, 0.0297165084630251,-0.2024746835231781,-0.3459660410881042, 0.0063600353896618,-0.1892726123332977,-0.5797371864318848, 0.5694028139114380,-0.1877164393663406, 0.2943242490291595,-0.1189196929335594, 0.1688601374626160,-0.3434416651725769, 0.0343681871891022, 0.9104954004287720, 0.0826938599348068,-0.2504964470863342],
[ 0.1576696485280991, 0.3415758907794952,-2.4149456024169920, 0.1536888480186462, 0.4105012118816376, 0.2345373034477234,-0.1837468296289444,-0.4501740932464600, 0.2224882841110230, 0.1705509126186371,-0.2065367251634598, 0.3595772385597229,-0.7206120491027832,-0.4491053819656372, 0.1489260196685791,-0.2078755944967270,-0.1114549115300179,-0.2203805148601532, 0.3675754368305206, 0.0953485220670700, 0.1777862012386322,-0.2281410396099091,-0.1738348156213760],
[-0.2950119376182556,-0.9303045868873600,-0.0975476428866386,-0.3378162682056427, 0.4441367089748383,-0.2765228152275085,-0.2475439757108688,-0.2194746583700180, 0.2451579868793488, 0.4024604260921478,-0.2064513713121414, 0.2813888192176819,-0.6637760400772095, 0.0449316427111626, 0.8324505686759950,-0.3399896621704102,-0.0452328324317932,-0.3437177538871765,-0.1955077201128006, 0.1649098694324493, 0.1014809906482697, 0.4486965835094452, 0.9936323761940000],
[ 0.2261059135198593, 1.2218697071075440, 0.3684991300106049, 0.1128033474087715, 0.4090075194835663,-0.8635524511337280,-0.2312024682760239,-0.1326341778039932,-3.0612339973449710, 0.3250098228454590,-1.6173484325408940, 0.3340947031974792,-0.2765322327613831,-0.0053953332826495,-1.3330141305923460,-1.2298245429992680,-0.2125422358512878, 0.5671714544296265, 0.0164676830172539, 0.0715715363621712,-1.1892844438552860,-0.8563022613525390,-0.3971797823905945],
[-0.2041305005550385, 0.1292132586240768,-0.4756734371185303,-0.1095641031861305,-0.3759761452674866,-0.3667056560516357,-0.1391211748123169, 0.1498781889677048, 0.3201478421688080,-0.2547450661659241,-0.2190467119216919, 0.3785935938358307, 0.6515979766845703, 0.0792408734560013, 0.3314294219017029, 0.2278000861406326,-0.0701173469424248, 0.3913973271846771, 0.2968440353870392,-0.1851735413074493,-0.4993448853492737, 0.4827063083648682,-0.6318664550781250],
[ 0.2620834112167358,-0.2166296392679214,-0.0047937314957380, 0.3573714792728424, 0.4180686771869659, 0.5225479006767273, 0.4665317535400391, 0.1828488558530807, 0.5458850264549255,-0.3341713249683380, 0.3633021712303162,-0.0708495825529099, 0.2787888944149017,-0.6002377867698669,-0.1816280186176300, 0.4862565994262695, 0.1640307456254959, 0.1751049011945724, 1.1175448894500730,-0.3071722984313965,-0.0481638051569462, 1.2166641950607300,-0.9934255480766300],
[ 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 1.0000000000000000]
];

//输入→隐藏层3，Weight+Biases
var ann_layer_3 =[
[ 0.7547526955604553, 1.2496923208236690,-0.6786937713623047, 0.3340738117694855,-0.8619624972343450,-0.9100691676139830,-0.9147103428840640, 0.5985627174377441,-0.2217774838209152, 0.0100187994539738, 0.0578798055648804],
[-0.3344712853431702,-0.7926886081695557, 0.0463503375649452, 0.9355223178863530, 0.1291898339986801,-0.8329933285713200,-0.1179928556084633,-0.6372105479240417,-0.6934132575988770, 0.4204989075660706, 0.2068644613027573],
[ 1.1273986101150510,-0.8085380792617800, 0.5487995743751526, 0.1276180297136307, 0.9837273359298710, 0.5076112747192383,-0.4056133031845093, 0.5679454803466797,-0.3442297577857971, 0.3695943951606750,-0.0618588589131832],
[-0.4434204995632172, 0.8991480469703670, 0.5731757879257202,-1.1420645713806150,-0.1439407020807266, 0.1274743825197220,-0.2499041408300400,-0.6018519401550293, 0.2078839093446732,-0.2068560719490051,-0.1364057362079620],
[ 0.4296855628490448,-0.1567237973213196,-0.3564070761203766,-0.8492499589920040,-0.7319144606590271, 0.1081330627202988,-0.3229343295097351,-0.0701727271080017, 1.0191169977188110,-0.3356615602970123, 0.0422828830778599],
[-0.0523690581321716, 0.0946270972490311,-0.2231194525957108, 1.2181951999664310, 0.5461908578872681,-0.3026173114776611, 0.5396252870559692, 0.4897217154502869, 0.0770220980048180, 0.4021805524826050,-0.1659308522939682],
[ 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 1.0000000000000000]
];

//输入→隐藏层4，Weight+Biases
var ann_layer_4 =[
[-0.7146292328834534, 0.3275278508663177,-2.2482719421386720,-0.7646439075469971,-0.8747664093971250, 0.0488723032176495, 0.0990600511431694],
[ 1.6122784614562990,-0.8120223283767700, 1.4159235954284670,-0.1353217214345932, 0.3792889118194580, 1.1401940584182740,-0.0990518629550934],
[ 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 0.0000000000000000, 1.0000000000000000]
];
